{% extends "./perfui/base.html" %}

{% block header %}
<style>
    .table > tbody > tr > td,th,thead {
	     vertical-align: middle;
	     height: 50px;
	     text-overflow: ellipsis; /* for IE */  
	    -moz-text-overflow: ellipsis; /* for Firefox,mozilla */  
	    overflow: hidden;   
	    white-space: nowrap;   
	}
	
	#operations {   
	   table-layout: fixed;   
	   width: 100% border:0px;   
	   margin: 0px;   
	} 
	
	.table > thead > tr > th{
		vertical-align: middle;
	}
	
	.mytd{
		text-align: left 
	}
	
</style>

<script>
	$(function() {
	    $.fn.editable.defaults.mode = 'inline';
	    $('#vex_operations a').editable({
	    	url:'/op/update',
	        success: function(response) {
	        	//alert(response)
		    },
		    error:function(data)
		    {
		        //alert(response);
		    }
	     });
	});
	
	function ucfirst(str) {
		var str = str.toLowerCase();
		str = str.replace(/\b\w+\b/g, function(word){
		  return word.substring(0,1).toUpperCase()+word.substring(1);
		});
		return str;
	}
	
	function operation(op_tag, op_id, btn_id, is_vex_operation){
		var btn = $("#" + btn_id);
		btn.button('loading');
		//setTimeout(function () { btn.button('reset'); },2000);
		
		$.getJSON("/op/execute?op_tag=" + op_tag + "&op_id=" + op_id + "&vex_op=" + is_vex_operation,
		    function(data)
	        {
				if(data["status_code"] == 200){
					bootbox.alert({
						title: "<p><strong class='text-info'>" + ucfirst(op_tag) + " Succeed</p>",
						message: "<p><strong class='text-success'>" + data["message"] + "</p>",
					    size: 'large'
					});
					btn.button('reset');
				}else{
					bootbox.alert({
						title: "<p><strong class='text-info'>" + ucfirst(op_tag) + " Failure</p>",
						message: "<p><strong class='text-danger'>" + data["message"] + "</p>",
					    size: 'large'
					});
					btn.button('reset');
				}
	        }
		);
	}
</script>
{% endblock%}

{% block main %}
<div class="divider"><h6 class="page-header"></h6></div>
<div class="row col-sm-12 col-md-12">
	<p><strong class="text-success">VEX Performance Test Operation</strong></p>
	 <div class="caption">
		<table id="vex_operations" data-toggle="table" class="table table-striped table-bordered table-hover">
			<colgroup>
				<col style="width:10%">
				<col style="width:10%">
				<col style="width:10%">
				<col style="width:10%">
				<col style="width:12%">
				<col style="width:12%">
				<col style="width:30%">
			</colgroup>
			<thead>
			    <tr>
			      <th class='text-center'>Name</th>
			      <th class='text-center'>Test Type</th>
			      <th class='text-center'>Content No.</th>
			      <th class='text-center'>Bitrate No.</th>
			      <th class='text-center'>Session No.</th>
			      <th class='text-center'>Warm Up</th>
			      <th class='text-center'>Operation</th>
			     </tr>
			</thead>
			<tbody>
			    {% for vex_operation in vex_operation_list %}
			    <tr class="success text-center">
			    {% if forloop.counter|divisibleby:"2" %}
				    <tr class="success text-center">
				{% elif forloop.counter|divisibleby:"3" %}
				    <tr class="active text-center">
				{% else %}
				    <tr class="warning text-center">
				{% endif %}
		            <td class="">{{ vex_operation.name }}</td>
		            <td>{{ vex_operation.perf_config.test_type }}</td>
		            <td><a href="#" id="content_size" name="content_size" data-pk="{{ vex_operation.id }}">{{ vex_operation.perf_config.content_size }}</a></td>
		            <td><a href="#" id="bitrate_number" name="bitrate_number" data-pk="{{ vex_operation.id }}">{{ vex_operation.perf_config.bitrate_number }}</a></td>
		            <td><a href="#" id="session_number" name="session_number" data-pk="{{ vex_operation.id }}">{{ vex_operation.perf_config.session_number }} </a>
		            	{% ifequal vex_operation.perf_config.test_type 'VOD_T6'%}
		            		/Second
		            	{% else %}
		            		Session
		            	{% endifequal %}
		            </td>
		            <td><a href="#" id="warm_up_minute" name="warm_up_minute" data-pk="{{ vex_operation.id }}">{{ vex_operation.perf_config.warm_up_minute }}</a> Minute</td>
		            <td class='mytd text-left'>
		            	{% if vex_operation.start_command%}
		            		<button type="button" id="btn_start_{{vex_operation.id}}" class="btn btn-success" data-loading-text="Starting..." autocomplete="off" onclick="operation('start','{{vex_operation.id}}','btn_start_{{vex_operation.id}}', 'true')">Start</button>
						{% endif %}
						{% if vex_operation.stop_command %}
						    <button type="button" id="btn_stop_{{vex_operation.id}}" class="btn btn-primary" data-loading-text="Stoping..." autocomplete="off" onclick="operation('stop','{{vex_operation.id}}','btn_stop_{{vex_operation.id}}', 'true')">Stop</button>
						{% endif%}
						{% if vex_operation.status_command %}
							<button type="button" id="btn_status_{{vex_operation.id}}" class="btn btn-warning" data-loading-text="Getting status..." onclick="operation('status','{{vex_operation.id}}','btn_status_{{vex_operation.id}}', 'true')">Status</button>
						{% endif%}
						{% if vex_operation.result_collect_command %}
							<button type="button" id="btn_result_{{vex_operation.id}}" class="btn btn-info" data-loading-text="Collecting..." onclick="operation('result','{{vex_operation.id}}','btn_result_{{vex_operation.id}}', 'true')">Result</button>
						{% endif%}
		            </td>
		        </tr>
		        {% endfor %}
			 </tbody>
		</table>
	</div>
	<div class="divider"><h5 class="page-header"></h5></div>
</div>

<div class="row col-sm-12 col-md-12">
	<p><strong class="text-success">Test Tool Operation</strong></p>
</div>
<div class="row col-sm-12 col-md-12">
    {% for sub_operation_list in operation_list %}
    {% if sub_operation_list %}
	<div class="col-sm-6 col-md-6">
		 <div class="caption">
			<table id="operations" data-toggle="table" class="table table-striped table-bordered table-hover">
				<colgroup>
					<col style="width:60%">
					<col style="width:40%">
				</colgroup>
				<thead>
				    <tr>
				      <th class='text-center'>Name</th>
				      <th class='text-center'>Operation</th>
				     </tr>
				</thead>
				<tbody>
				    {% for basic_operation in sub_operation_list %}
				    {% if forloop.counter|divisibleby:"2" %}
					    <tr class="success text-center">
					{% elif forloop.counter|divisibleby:"3" %}
					    <tr class="active text-center">
					{% else %}
					    <tr class="warning text-center">
					{% endif %}
			            <td class='text-left'>{{ basic_operation.name }}</td>
			            <td class='text-left'>
			            	{% if basic_operation.start_command %}
			            		{% if basic_operation.stop_command %}
			            			<button type="button" id="btn_start_op_{{basic_operation.id}}" class="btn btn-success" data-loading-text="Starting..." autocomplete="off" onclick="operation('start','{{basic_operation.id}}','btn_start_op_{{basic_operation.id}}', 'false')">Start</button>
								{% else %}
									<button type="button" id="btn_start_op_{{basic_operation.id}}" class="btn btn-success" data-loading-text="Running" autocomplete="off" onclick="operation('run','{{basic_operation.id}}','btn_start_op_{{basic_operation.id}}', 'false')">Run</button>
								{% endif %}
							{% endif %}
							{% if basic_operation.stop_command %}
								<button type="button" id="btn_stop_op_{{basic_operation.id}}" class="btn btn-primary" data-loading-text="Stoping..." autocomplete="off" onclick="operation('stop','{{basic_operation.id}}','btn_stop_op_{{basic_operation.id}}', 'false')">Stop</button>
							{% endif%}
							{% if basic_operation.status_command %}
								<button type="button" id="btn_status_op_{{basic_operation.id}}" class="btn btn-warning" data-loading-text="Getting status..." onclick="operation('status','{{basic_operation.id}}','btn_status_op_{{basic_operation.id}}', 'false')">Status</button>
							{% endif%}
			            </td>
			        </tr>
			        {% endfor %}
				 </tbody>
			</table>
		</div>
	</div>
	{% endif %}
	{% endfor %}
</div>
{% endblock%}